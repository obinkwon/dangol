<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="dao.IAdminDao">
	<select id="showMain" parameterType="admin" resultType="admin">
		SELECT 
			ANUM AS anum
			,ATYPE AS atype
			,AVALUE AS avalue
		FROM 
			ADMINS 
		WHERE 
			ATYPE = #{atype} 
	</select>
	
	<insert id="insertTag" parameterType="admin">
		INSERT INTO ADMINS(
			ANUM
			,ATYPE
			,AVALUE
			,AIMAGE
		)VALUES(
			ADMINS_SEQ.NEXTVAL
			,#{atype}
			,#{avalue}
			,#{aimage,jdbcType=VARCHAR}
		)
	</insert>
	
	<delete id="deleteTag" parameterType="admin">
		DELETE FROM 
			ADMINS 
		WHERE 
			ANUM = #{anum}
	</delete>
	
	<update id="updateMain" parameterType="admin">
		UPDATE 
			ADMINS 
		SET 
			AVALUE=#{avalue} 
		WHERE 
			ATYPE = #{atype}
	</update>
	
	<select id="showThemeTags" resultType="admin">
		SELECT 
			ANUM
			,ATYPE
			,AVALUE
			,AIMAGE
		FROM 
			ADMINS 
		WHERE 
			ATYPE = 'theme'
	</select>
	
	<select id="showTasteTags" resultType="admin">
		SELECT * FROM ADMINS WHERE ATYPE = 'taste'  
	</select>
	
	<select id="showFoodTags" resultType="admin">
		SELECT * FROM ADMINS WHERE ATYPE = 'food'  
	</select>
	
  	<select id="selectOneAdmin" resultType="Admin" parameterType="int">
		SELECT * FROM ADMINS WHERE ANUM=#{anum}
	</select>
	
	
	<!-- 1:1문의 -->
	<select id="selectInquiryList" parameterType="inquiry" resultType="inquiry">
		SELECT 
			ROWNUM
			,INUM AS inum
			,ITYPE AS itype
			,ITITLE AS ititle
			,ICONTENT AS icontent
			,IDATE AS idate
			,ISTATE AS istate
			,IANSWER AS ianswer
		FROM 
			INQUIRYS
		WHERE 1=1
		<if test="istate != null and istate != ''">
			AND ISTATE = #{istate}
		</if>
		<if test="keyword != null and keyword != ''" >
			<if test="type == 'title'">
				AND ITITLE LIKE '%'||#{keyword}||'%'
			</if>
			<if test="type == 'content'">
				AND ICONTENT LIKE '%'||#{keyword}||'%'
			</if>
			<if test="type == 'mid'">
				AND mid LIKE '%'||#{keyword}||'%'
				OR bid LIKE '%'||#{keyword}||'%'
			</if>
		</if>
		ORDER BY IDATE DESC
	</select>
	
	<select id="inquiryListCount" resultType="inquiry">
		SELECT 
			'전체' AS ititle 
			,'all' AS itype
			,count(*) AS cnt
		FROM 
			INQUIRYS
		UNION ALL 
		SELECT 
			'답변완료' AS ititle
			,'yes' AS itype
			, count(*) AS cnt
		FROM 
			INQUIRYS 
		WHERE ISTATE = 'yes'
		UNION ALL 
		SELECT 
			'미답변' AS ititle
			,'no' AS itype
			, count(*) AS cnt
		FROM 
			INQUIRYS 
		WHERE 
			ISTATE = 'no'
	</select>
	
	<!-- 문의 상세보기 -->
	<select id="selectInquiry" parameterType="inquiry" resultType="inquiry">
		SELECT
			INUM AS inum
			,MID AS mid
			,BID AS bid
			,ITYPE AS itype
			,ITITLE AS ititle
			,ICONTENT AS icontent
			,IDATE AS idate
			,ISTATE AS istate
			,IANSWER AS ianswer
			,(SELECT MPHONE FROM MEMBERS WHERE MID = A.MID) AS MPHONE
			,(SELECT BPHONE FROM BOSS WHERE BID = A.BID) AS BPHONE
		FROM 
			INQUIRYS A 
		WHERE 
			INUM = #{inum}
	</select>
	
	<!-- 답변 등록하기 -->	
	<update id="insertInquiryAnswer" parameterType="Inquiry">
		UPDATE 
			INQUIRYS 
		SET 
			IANSWER = #{ianswer}
			, ISTATE = 'yes' 
		WHERE 
			INUM = #{inum}
	</update>
	
	<select id="selectAllInquirys"  resultType="inquiry">
		SELECT 
			INUM AS inum
			,MID AS mid
			,BID AS bid
			,ITYPE AS itype
			,ITITLE AS ititle
			,ICONTENT AS icontent
			,IDATE AS idate
			,ISTATE AS istate
			,IANSWER AS ianswer
		FROM 
			INQUIRYS 
		ORDER BY IDATE DESC
	</select>

	<select id="countAllInquirys" resultType="int">
		SELECT 
			COUNT (*) 
		FROM 
			INQUIRYS
	</select>
	
	<select id="selectYesInquirys" resultType="inquiry">
		SELECT * FROM INQUIRYS WHERE ISTATE='yes' ORDER BY IDATE DESC
	</select>
	
	<select id="countYesInquirys" resultType="int">
		SELECT COUNT (*) FROM INQUIRYS WHERE ISTATE='yes' ORDER BY IDATE DESC
	</select>
	
	<select id="selectNoInquirys" resultType="inquiry">
		SELECT * FROM INQUIRYS WHERE ISTATE='no' ORDER BY IDATE DESC
	</select>
	
	<select id="countNoInquirys" resultType="int">
		SELECT COUNT (*) FROM INQUIRYS WHERE ISTATE='no'
	</select>
		
	<!-- 글 선택하기 -->
	<select id="selectOneInquiry" resultType="inquiry" parameterType="int">
		SELECT * FROM INQUIRYS WHERE INUM=#{inum}
	</select>
	
	<!-- 글 검색하기 -->
	<!-- 제목검색 -->
	<select id="selectInquirysByTitle" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE ITITLE LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>
	<select id="selectYesInquirysByTitle" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE ISTATE='yes' AND ITITLE LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>
	<select id="selectNoInquirysByTitle" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE ISTATE='no' AND ITITLE LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>
	
	<!-- 내용검색 -->
	<select id="selectInquirysByContent" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE ICONTENT LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>
	<select id="selectYesInquirysByContent" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE ISTATE='yes' AND ICONTENT LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>
	<select id="selectNoInquirysByContent" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE ISTATE='no' AND ICONTENT LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>
	
	<!-- id검색 -->
	<select id="selectInquirysByMid" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE MID LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>		
	<select id="selectYesInquirysByMid" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE ISTATE='yes' AND MID LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>		
	<select id="selectNoInquirysByMid" resultType="inquiry" parameterType="String">
		SELECT * FROM INQUIRYS WHERE ISTATE='no' AND MID LIKE '%'||#{keyword}||'%' ORDER BY IDATE DESC
	</select>		
</mapper>
    